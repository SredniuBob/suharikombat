<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>‚Çø CRYPTO KOMBAT</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }

        :root {
            --primary: #1a73e8;
            --secondary: #0d47a1;
            --accent: #00c853;
            --danger: #ff4444;
            --warning: #ff9800;
            --dark: #121212;
        }

        body {
            background: linear-gradient(135deg, #0a1929, #1a237e);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-tabs {
            display: flex;
            overflow-x: auto;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin: -20px -20px 20px -20px;
            gap: 5px;
        }

        .nav-tabs button {
            flex: 1;
            min-width: 70px;
            padding: 12px 8px;
            background: transparent;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .nav-tabs button.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .stat-card, .upgrade-card, .nft-card, .game-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .stat-card h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00e676;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .click-btn {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 5px solid #4fc3f7;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px auto;
            box-shadow: 0 10px 30px rgba(26, 115, 232, 0.4);
        }

        .click-btn:active {
            transform: scale(0.95);
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--accent), #00e676);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 200, 83, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #666;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ffb74d);
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ª–∏–º–∏—Ç–∞ */
        .limit-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .limit-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .limit-fill {
            height: 100%;
            background: linear-gradient(90deg, #00c853, #00e676);
            transition: width 0.3s;
        }

        /* PvP –∞—Ä–µ–Ω–∞ */
        .pvp-arena {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin: 20px 0;
        }

        .players {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .player {
            text-align: center;
            padding: 20px;
            min-width: 120px;
        }

        .player-score {
            font-size: 2.5rem;
            font-weight: bold;
            color: #00e676;
            margin: 10px 0;
        }

        /* –ú–∏–Ω–∏-–∏–≥—Ä—ã */
        .minigame-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .minigame {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .minigame:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
        }

        /* NFT */
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .nft-card {
            text-align: center;
            position: relative;
        }

        .nft-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .common { background: rgba(117, 117, 117, 0.3); color: #fff; }
        .uncommon { background: rgba(76, 175, 80, 0.3); color: #4caf50; }
        .rare { background: rgba(33, 150, 243, 0.3); color: #2196f3; }
        .epic { background: rgba(156, 39, 176, 0.3); color: #9c27b0; }
        .legendary { background: rgba(255, 215, 0, 0.3); color: #ffd700; }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1a237e;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            border: 2px solid #4fc3f7;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: rgba(0, 200, 83, 0.9);
            color: white;
            border-radius: 10px;
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 1001;
            font-weight: bold;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .notification.warning {
            background: rgba(255, 152, 0, 0.9);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: 1fr; }
            .click-btn { width: 150px; height: 150px; font-size: 1.3rem; }
            .nav-tabs button { min-width: 60px; font-size: 0.8rem; }
            .minigame-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="promocode-modal">
        <div class="modal-content">
            <h3>üéÅ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</h3>
            <input type="text" id="promocode-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" style="width:100%;padding:10px;margin:15px 0;border-radius:5px;background:rgba(255,255,255,0.1);color:white;border:1px solid #4fc3f7;">
            <div style="display:flex;gap:10px;">
                <button class="btn" onclick="activatePromocode()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn btn-danger" onclick="closeModal('promocode-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="nav-tabs">
        <button onclick="showSection('main')" class="active">üéÆ –ò–≥—Ä–∞</button>
        <button onclick="showSection('upgrades')">‚ö° –£–ª—É—á—à–µ–Ω–∏—è</button>
        <button onclick="showSection('nft')">üé¥ NFT</button>
        <button onclick="showSection('pvp')">‚öîÔ∏è PvP</button>
        <button onclick="showSection('minigames')">üéØ –ú–∏–Ω–∏-–∏–≥—Ä—ã</button>
        <button onclick="showSection('referral')">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
    </div>

    <div class="container">
        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="main-section" class="section active">
            <div class="header">
                <h1>‚Çø CRYPTO KOMBAT</h1>
                <p>–ö–ª–∏–∫–∞–π, –º–∞–π–Ω–∏ –∏ —Å—Ç–∞–Ω—å –∫—Ä–∏–ø—Ç–æ-–∫–æ—Ä–æ–ª—ë–º!</p>
                <div style="margin-top: 10px;">
                    <button class="btn btn-warning" onclick="openModal('promocode-modal')" style="width:auto;padding:8px 15px;">
                        üéÅ –ü—Ä–æ–º–æ–∫–æ–¥
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–ë–ê–õ–ê–ù–°</h3>
                    <div class="value" id="balance">0 ‚Çø</div>
                </div>
                <div class="stat-card">
                    <h3>–ó–ê –ö–õ–ò–ö</h3>
                    <div class="value" id="per-click">1 ‚Çø</div>
                </div>
                <div class="stat-card">
                    <h3>–£–†–û–í–ï–ù–¨</h3>
                    <div class="value" id="level">1</div>
                </div>
                <div class="stat-card">
                    <h3>–ê–í–¢–û-–î–û–•–û–î</h3>
                    <div class="value" id="passive-income">0 ‚Çø/—Å–µ–∫</div>
                </div>
            </div>

            <!-- –õ–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤ -->
            <div class="limit-container">
                <div class="limit-bar">
                    <div class="limit-fill" id="limit-fill" style="width: 100%"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                    <span>–ö–ª–∏–∫–æ–≤: <strong id="current-clicks">50</strong>/<strong id="max-clicks">50</strong></span>
                    <span id="reset-time">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: 2:00</span>
                </div>
                <button class="btn btn-warning" id="reset-btn" onclick="resetClickLimit()" style="display:none;">
                    üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç (100 ‚Çø)
                </button>
            </div>

            <button class="click-btn" id="click-btn">
                ‚õèÔ∏è –ú–ê–ô–ù–ò–¢–¨
                <div style="font-size: 1rem; margin-top: 10px; color: #00e676;">
                    +<span id="click-value">1</span> ‚Çø –∑–∞ –∫–ª–∏–∫
                </div>
            </button>

            <div style="text-align: center;">
                <button class="btn" onclick="showSection('upgrades')">
                    ‚ö° –°–ú–û–¢–†–ï–¢–¨ –£–õ–£–ß–®–ï–ù–ò–Ø
                </button>
            </div>
        </div>

        <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
        <div id="upgrades-section" class="section">
            <div class="header">
                <h1>‚ö° –£–õ–£–ß–®–ï–ù–ò–Ø</h1>
                <p>–£–ª—É—á—à–∞–π —Å–≤–æ—é —Ñ–µ—Ä–º—É –∏ –ª–∏–º–∏—Ç—ã!</p>
            </div>
            <div id="upgrades-container"></div>
        </div>

        <!-- NFT -->
        <div id="nft-section" class="section">
            <div class="header">
                <h1>üé¥ NFT –ö–û–õ–õ–ï–ö–¶–ò–Ø</h1>
                <p>–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä—É–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã!</p>
            </div>
            
            <div class="nft-grid" id="nft-shop">
                <div class="nft-card" onclick="buyNftBox('basic')">
                    <h3>ü•â –ë–ê–ó–û–í–´–ô</h3>
                    <div class="nft-rarity common">–æ–±—ã—á–Ω—ã–π</div>
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 10,000 ‚Çø</p>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="nft-card" onclick="buyNftBox('premium')">
                    <h3>ü•à –ü–†–ï–ú–ò–£–ú</h3>
                    <div class="nft-rarity rare">—Ä–µ–¥–∫–∏–π</div>
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 50,000 ‚Çø</p>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="nft-card" onclick="buyNftBox('legendary')">
                    <h3>ü•á –õ–ï–ì–ï–ù–î–ê–†–ù–´–ô</h3>
                    <div class="nft-rarity legendary">–ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</div>
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 100,000 ‚Çø</p>
                    <button class="btn">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0;">–í–∞—à–∏ NFT:</h3>
            <div id="nft-inventory"></div>
        </div>

        <!-- PvP –ê—Ä–µ–Ω–∞ -->
        <div id="pvp-section" class="section">
            <div class="header">
                <h1>‚öîÔ∏è PvP –ê–†–ï–ù–ê</h1>
                <p>–°—Ä–∞–∂–∞–π—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏!</p>
            </div>

            <div class="pvp-arena" id="battle-arena" style="display:none;">
                <h2 id="battle-title">–ë–æ–π —Å –ë–æ—Ç–æ–º</h2>
                <div class="players">
                    <div class="player">
                        <div>–í—ã</div>
                        <div class="player-score" id="player1-score">0</div>
                    </div>
                    <div style="font-size: 2rem; display: flex; align-items: center;">VS</div>
                    <div class="player">
                        <div id="opponent-name">–ë–æ—Ç</div>
                        <div class="player-score" id="player2-score">0</div>
                    </div>
                </div>
                <div id="battle-timer" style="font-size: 3rem; color: #ff4444; margin: 20px 0;">60</div>
                <button class="btn btn-danger" onclick="pvpClick()" id="pvp-click-btn">‚öîÔ∏è –ö–õ–ò–ö–ê–¢–¨!</button>
            </div>

            <div id="pvp-menu">
                <div class="upgrade-card">
                    <h3>ü§ñ –ë–æ–π —Å –±–æ—Ç–æ–º</h3>
                    <p>–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –ò–ò-–±–æ—Ç–æ–º. –°—Ç–∞–≤–∫–∞: 100 ‚Çø</p>
                    <button class="btn" onclick="startPvPBattle('bot')">–ù–∞—á–∞—Ç—å –±–æ–π</button>
                </div>
                <div class="upgrade-card">
                    <h3>üë§ –°–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫</h3>
                    <p>–ù–∞–π–¥–∏—Ç–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞. –°—Ç–∞–≤–∫–∞: 500 ‚Çø</p>
                    <button class="btn" onclick="startPvPBattle('player')">–ù–∞–π—Ç–∏ –±–æ–π</button>
                </div>
            </div>
        </div>

        <!-- –ú–∏–Ω–∏-–∏–≥—Ä—ã -->
        <div id="minigames-section" class="section">
            <div class="header">
                <h1>üéØ –ú–ò–ù–ò-–ò–ì–†–´</h1>
                <p>–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã!</p>
            </div>

            <div class="minigame-container">
                <div class="minigame" onclick="startMinigame('clicker')">
                    <h3>‚ö° –ö–ª–∏–∫-—á–µ–ª–ª–µ–Ω–¥–∂</h3>
                    <p>–ö–ª–∏–∫–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!</p>
                    <div style="color: #00e676; margin-top: 10px;">–ü—Ä–∏–∑: –¥–æ 1,000 ‚Çø</div>
                </div>
                <div class="minigame" onclick="startMinigame('number')">
                    <h3>üî¢ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ</h3>
                    <p>–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100 –∑–∞ 5 –ø–æ–ø—ã—Ç–æ–∫</p>
                    <div style="color: #00e676; margin-top: 10px;">–ü—Ä–∏–∑: –¥–æ 2,000 ‚Çø</div>
                </div>
                <div class="minigame" onclick="startMinigame('memory')">
                    <h3>üß† –ü–∞–º—è—Ç—å</h3>
                    <p>–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–∏—Å–µ–ª</p>
                    <div style="color: #00e676; margin-top: 10px;">–ü—Ä–∏–∑: –¥–æ 3,000 ‚Çø</div>
                </div>
                <div class="minigame" onclick="startMinigame('slots')">
                    <h3>üé∞ –°–ª–æ—Ç—ã</h3>
                    <p>–ò—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É –Ω–∞ –∏–≥—Ä–æ–≤—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∞—Ö</p>
                    <div style="color: #00e676; margin-top: 10px;">–ü—Ä–∏–∑: –¥–æ 5,000 ‚Çø</div>
                </div>
            </div>

            <div id="minigame-container" style="display:none;"></div>
        </div>

        <!-- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ -->
        <div id="referral-section" class="section">
            <div class="header">
                <h1>üë• –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê</h1>
                <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã!</p>
            </div>

            <div class="upgrade-card">
                <h3>–í–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥:</h3>
                <div style="font-size: 2rem; letter-spacing: 3px; background: rgba(79, 195, 247, 0.2); padding: 15px; border-radius: 10px; margin: 15px 0; border: 2px dashed #4fc3f7;">
                    <span id="referral-code">CRYPTO123</span>
                </div>
                <button class="btn" onclick="copyReferralCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π</h3>
                    <div class="value" id="referrals-count">0</div>
                </div>
                <div class="stat-card">
                    <h3>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤</h3>
                    <div class="value" id="referral-earnings">0 ‚Çø</div>
                </div>
            </div>

            <div class="upgrade-card">
                <h3>üíé –ë–æ–Ω—É—Å—ã –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:</h3>
                <ul style="padding-left: 20px; margin-top: 10px;">
                    <li>1 –¥—Ä—É–≥: +10% –∫ –¥–æ—Ö–æ–¥—É –∑–∞ –∫–ª–∏–∫</li>
                    <li>3 –¥—Ä—É–≥–∞: +1 –∫ –ª–∏–º–∏—Ç—É –∫–ª–∏–∫–æ–≤</li>
                    <li>5 –¥—Ä—É–∑–µ–π: +25% –∫ –¥–æ—Ö–æ–¥—É –∑–∞ –∫–ª–∏–∫</li>
                    <li>10 –¥—Ä—É–∑–µ–π: √ó2 –∫ –ø—Ä–∏–∑–∞–º –≤ –º–∏–Ω–∏-–∏–≥—Ä–∞—Ö</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // ====== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM ======
        let tg = window.Telegram?.WebApp || null;
        
        if (tg) {
            tg.ready();
            tg.expand();
            tg.setBackgroundColor('#0a1929');
            tg.setHeaderColor('#0a1929');
        }

        // ====== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ======
        let gameState = {
            balance: 10000,
            per_click: 1,
            passive_per_sec: 0,
            level: 1,
            experience: 0,
            total_clicks: 0,
            
            // –õ–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤ —Å–∏—Å—Ç–µ–º–∞
            click_limit: 50,
            click_limit_used: 0,
            click_limit_reset: Date.now() + 120000,
            
            // –£–ª—É—á—à–µ–Ω–∏—è
            upgrades: {
                basic_rig: 0,
                gpu_farm: 0,
                asic_miner: 0,
                mining_pool: 0,
                click_limit_boost: 0,
                click_speed: 0,
                referral_boost: 0
            },
            
            // NFT —Å–∏—Å—Ç–µ–º–∞
            nfts: [],
            nft_boost: 1,
            
            // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
            referral_code: generateReferralCode(),
            referrals: [],
            referral_earnings: 0,
            
            // PvP —Å–∏—Å—Ç–µ–º–∞
            pvp_wins: 0,
            pvp_losses: 0,
            
            // –ü—Ä–æ–º–æ–∫–æ–¥—ã
            used_promocodes: [],
            
            // –ú–∏–Ω–∏-–∏–≥—Ä—ã
            minigame_stats: {
                clicker: { played: 0, best: 0 },
                number: { played: 0, wins: 0 },
                memory: { played: 0, best: 0 },
                slots: { played: 0, wins: 0 }
            }
        };

        // –£–ª—É—á—à–µ–Ω–∏—è
        const upgrades = [
            { id: 'basic_rig', name: 'üì± –ë–∞–∑–æ–≤—ã–π —Ä–∏–≥', desc: '–ü—Ä–æ—Å—Ç–∞—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞', cost: 100, click: 1, passive: 0.1 },
            { id: 'gpu_farm', name: 'üíª GPU –§–µ—Ä–º–∞', desc: '–ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç', cost: 500, click: 5, passive: 0.5 },
            { id: 'asic_miner', name: '‚ö° ASIC –ú–∞–π–Ω–µ—Ä', desc: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä', cost: 2000, click: 20, passive: 2 },
            { id: 'mining_pool', name: 'üèä‚Äç‚ôÇÔ∏è –ú–∞–π–Ω–∏–Ω–≥-–ø—É–ª', desc: '–û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –º–æ—â–Ω–æ—Å—Ç—å', cost: 5000, click: 50, passive: 5 },
            { id: 'click_limit_boost', name: '‚ö° –£–ª—É—á—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞', desc: '+10 –∫ –ª–∏–º–∏—Ç—É –∫–ª–∏–∫–æ–≤', cost: 1000, limit_bonus: 10 },
            { id: 'click_speed', name: 'üöÄ –°–∫–æ—Ä–æ—Å—Ç—å –∫–ª–∏–∫–∞', desc: '+5 –∫ —Å–∏–ª–µ –∫–ª–∏–∫–∞', cost: 5000, click: 5 },
            { id: 'referral_boost', name: 'üë• –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±—É—Å—Ç', desc: '+10% –∫ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–º—É –¥–æ—Ö–æ–¥—É', cost: 3000, referral_bonus: 0.1 }
        ];

        // NFT –ø—Ä–µ–¥–º–µ—Ç—ã
        const nftItems = [
            { id: 'golden_rig', name: 'üî• –ó–æ–ª–æ—Ç–æ–π –†–∏–≥', rarity: 'legendary', price: 100000, bonus: 2.0 },
            { id: 'quantum_miner', name: '‚öõÔ∏è –ö–≤–∞–Ω—Ç–æ–≤—ã–π –ú–∞–π–Ω–µ—Ä', rarity: 'epic', price: 50000, bonus: 1.5 },
            { id: 'ai_trader', name: 'üß† AI –¢—Ä–µ–π–¥–µ—Ä', rarity: 'rare', price: 20000, bonus: 1.3 },
            { id: 'crypto_cpu', name: 'üíé –ö—Ä–∏–ø—Ç–æ-–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä', rarity: 'uncommon', price: 10000, bonus: 1.2 },
            { id: 'basic_gpu', name: 'üìä –ë–∞–∑–æ–≤–∞—è GPU', rarity: 'common', price: 5000, bonus: 1.1 }
        ];

        // –ü—Ä–æ–º–æ–∫–æ–¥—ã
        const promocodes = {
            'CRYPTO1000': { reward: 1000, uses: 9999 },
            'WELCOME500': { reward: 500, uses: 9999 },
            'VIP2000': { reward: 2000, uses: 9999 },
            'BONUS3000': { reward: 3000, uses: 9999 }
        };

        // –¢–∞–π–º–µ—Ä—ã
        let pvpTimer = null;
        let battleTime = 60;
        let minigameTimer = null;

        // ====== –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• ======
        function saveGame() {
            try {
                gameState.last_save = Date.now();
                const saveData = JSON.stringify(gameState);
                
                if (tg?.CloudStorage) {
                    tg.CloudStorage.setItem('game_save', saveData);
                }
                
                localStorage.setItem('cryptoKombat', saveData);
                localStorage.setItem('cryptoKombat_last_save', Date.now().toString());
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
            }
        }

        function loadGame() {
            try {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Telegram
                if (tg?.CloudStorage) {
                    tg.CloudStorage.getItem('game_save').then(saved => {
                        if (saved) {
                            const loaded = JSON.parse(saved);
                            Object.assign(gameState, loaded);
                            initGame();
                        }
                    }).catch(() => loadFromLocalStorage());
                } else {
                    loadFromLocalStorage();
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                initGame();
            }
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('cryptoKombat');
            if (saved) {
                const loaded = JSON.parse(saved);
                Object.assign(gameState, loaded);
            }
            initGame();
        }

        // ====== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ======
        function initGame() {
            updateUI();
            renderUpgrades();
            loadNFTInventory();
            updateReferralUI();
            startPassiveIncome();
            startClickLimitTimer();
            
            // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
            checkDailyBonus();
            
            console.log('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ë–∞–ª–∞–Ω—Å:', gameState.balance);
        }

        function updateUI() {
            document.getElementById('balance').textContent = formatNumber(gameState.balance) + ' ‚Çø';
            document.getElementById('per-click').textContent = formatNumber(gameState.per_click * gameState.nft_boost) + ' ‚Çø';
            document.getElementById('click-value').textContent = Math.floor(gameState.per_click * gameState.nft_boost);
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('passive-income').textContent = gameState.passive_per_sec.toFixed(1) + ' ‚Çø/—Å–µ–∫';
            
            updateClickLimitUI();
        }

        function formatNumber(num) {
            return Math.floor(num).toLocaleString('ru-RU');
        }

        // ====== –°–ò–°–¢–ï–ú–ê –ö–õ–ò–ö–û–í ======
        document.getElementById('click-btn').addEventListener('click', function() {
            if (gameState.click_limit_used >= gameState.click_limit) {
                showNotification('–õ–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤ –∏—Å—á–µ—Ä–ø–∞–Ω!', 'error');
                return;
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            this.style.transform = 'scale(0.95)';
            setTimeout(() => this.style.transform = 'scale(1)', 100);
            
            // –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ—Ç–¥–∞—á–∞
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –¥–µ–Ω—å–≥–∏ —Å —É—á–µ—Ç–æ–º NFT –±—É—Å—Ç–∞
            const clickValue = Math.floor(gameState.per_click * gameState.nft_boost);
            gameState.balance += clickValue;
            gameState.total_clicks++;
            gameState.click_limit_used++;
            gameState.experience++;
            
            // –£—Ä–æ–≤–µ–Ω—å
            if (gameState.experience >= gameState.level * 100) {
                gameState.level++;
                gameState.experience = 0;
                gameState.per_click += Math.floor(gameState.level / 2);
                showNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å ${gameState.level}! +${Math.floor(gameState.level / 2)} –∫ –∫–ª–∏–∫—É`, 'success');
                
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('heavy');
                }
            }
            
            updateUI();
            saveGame();
        });

        // ====== –õ–ò–ú–ò–¢ –ö–õ–ò–ö–û–í ======
        function updateClickLimitUI() {
            const used = gameState.click_limit_used;
            const total = gameState.click_limit;
            const percentage = Math.max(0, ((total - used) / total) * 100);
            
            document.getElementById('limit-fill').style.width = percentage + '%';
            document.getElementById('current-clicks').textContent = total - used;
            document.getElementById('max-clicks').textContent = total;
            
            const resetBtn = document.getElementById('reset-btn');
            if (used >= total) {
                resetBtn.style.display = 'block';
                document.getElementById('limit-fill').style.background = 'linear-gradient(90deg, #ff4444, #ff9800)';
            } else {
                resetBtn.style.display = 'none';
                document.getElementById('limit-fill').style.background = 'linear-gradient(90deg, #00c853, #00e676)';
            }
        }

        function startClickLimitTimer() {
            setInterval(() => {
                const now = Date.now();
                if (now >= gameState.click_limit_reset) {
                    gameState.click_limit_used = 0;
                    gameState.click_limit_reset = now + 120000; // 2 –º–∏–Ω—É—Ç—ã
                    updateClickLimitUI();
                }
                
                const timeLeft = Math.max(0, gameState.click_limit_reset - now);
                const minutes = Math.floor(timeLeft / 60000);
                const seconds = Math.floor((timeLeft % 60000) / 1000);
                document.getElementById('reset-time').textContent = 
                    `–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function resetClickLimit() {
            if (gameState.click_limit_used < gameState.click_limit) {
                showNotification('–õ–∏–º–∏—Ç –µ—â–µ –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω!', 'warning');
                return;
            }
            
            const cost = 100;
            if (gameState.balance < cost) {
                showNotification(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –ù—É–∂–Ω–æ ${cost} ‚Çø`, 'error');
                return;
            }
            
            gameState.balance -= cost;
            gameState.click_limit_used = 0;
            gameState.click_limit_reset = Date.now() + 120000;
            updateClickLimitUI();
            updateUI();
            saveGame();
            showNotification('–õ–∏–º–∏—Ç –∫–ª–∏–∫–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!', 'success');
        }

        // ====== –£–õ–£–ß–®–ï–ù–ò–Ø ======
        function buyUpgrade(upgradeId) {
            const upgrade = upgrades.find(u => u.id === upgradeId);
            if (!upgrade) return;
            
            const currentLevel = gameState.upgrades[upgradeId] || 0;
            const cost = Math.floor(upgrade.cost * Math.pow(1.5, currentLevel));
            
            if (gameState.balance < cost) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
                return;
            }
            
            gameState.balance -= cost;
            gameState.upgrades[upgradeId] = currentLevel + 1;
            
            if (upgrade.click) {
                gameState.per_click += upgrade.click;
            }
            if (upgrade.passive) {
                gameState.passive_per_sec += upgrade.passive;
            }
            if (upgrade.limit_bonus) {
                gameState.click_limit += upgrade.limit_bonus;
            }
            
            updateUI();
            renderUpgrades();
            saveGame();
            
            showNotification(`‚úÖ –ö—É–ø–ª–µ–Ω–æ: ${upgrade.name}`, 'success');
        }

        function renderUpgrades() {
            const container = document.getElementById('upgrades-container');
            container.innerHTML = '';
            
            upgrades.forEach(upgrade => {
                const currentLevel = gameState.upgrades[upgrade.id] || 0;
                const cost = Math.floor(upgrade.cost * Math.pow(1.5, currentLevel));
                const canBuy = gameState.balance >= cost;
                
                const card = document.createElement('div');
                card.className = 'upgrade-card';
                card.innerHTML = `
                    <h3>${upgrade.name} (${currentLevel})</h3>
                    <p>${upgrade.desc}</p>
                    <div style="color: #00e676; margin: 10px 0;">
                        ${upgrade.click ? `+${upgrade.click} –∫ –∫–ª–∏–∫—É` : ''}
                        ${upgrade.passive ? `<br>+${upgrade.passive} ‚Çø/—Å–µ–∫` : ''}
                        ${upgrade.limit_bonus ? `<br>+${upgrade.limit_bonus} –∫ –ª–∏–º–∏—Ç—É` : ''}
                        ${upgrade.referral_bonus ? `<br>+${upgrade.referral_bonus * 100}% –∫ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º` : ''}
                    </div>
                    <button class="btn" onclick="buyUpgrade('${upgrade.id}')" ${!canBuy ? 'disabled' : ''}>
                        ${currentLevel === 0 ? '–ö–£–ü–ò–¢–¨' : '–£–õ–£–ß–®–ò–¢–¨'} –ó–ê ${formatNumber(cost)} ‚Çø
                    </button>
                `;
                container.appendChild(card);
            });
        }

        // ====== NFT –°–ò–°–¢–ï–ú–ê ======
        function buyNftBox(type) {
            let price, rarityWeights;
            
            switch(type) {
                case 'basic':
                    price = 10000;
                    rarityWeights = [0.7, 0.2, 0.1, 0, 0]; // 70% common, 20% uncommon, 10% rare
                    break;
                case 'premium':
                    price = 50000;
                    rarityWeights = [0, 0.3, 0.4, 0.25, 0.05]; // 30% uncommon, 40% rare, 25% epic, 5% legendary
                    break;
                case 'legendary':
                    price = 100000;
                    rarityWeights = [0, 0, 0.3, 0.4, 0.3]; // 30% rare, 40% epic, 30% legendary
                    break;
                default:
                    return;
            }
            
            if (gameState.balance < price) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
                return;
            }
            
            gameState.balance -= price;
            
            // –í—ã–±–∏—Ä–∞–µ–º —Ä–µ–¥–∫–æ—Å—Ç—å
            const random = Math.random();
            let cumulative = 0;
            let rarityIndex = 0;
            
            for (let i = 0; i < rarityWeights.length; i++) {
                cumulative += rarityWeights[i];
                if (random <= cumulative) {
                    rarityIndex = i;
                    break;
                }
            }
            
            const nft = JSON.parse(JSON.stringify(nftItems[rarityIndex])); // –ö–æ–ø–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç
            nft.id = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            nft.equipped = false;
            
            gameState.nfts.push(nft);
            
            updateUI();
            loadNFTInventory();
            saveGame();
            
            const rarityNames = ['–æ–±—ã—á–Ω—ã–π', '–Ω–µ–æ–±—ã—á–Ω—ã–π', '—Ä–µ–¥–∫–∏–π', '—ç–ø–∏—á–µ—Å–∫–∏–π', '–ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π'];
            showNotification(`üéâ –ü–æ–ª—É—á–µ–Ω NFT: ${nft.name} (${rarityNames[rarityIndex]})! –ë–æ–Ω—É—Å: √ó${nft.bonus}`, 'success');
        }

        function equipNft(nftId) {
            // –°–Ω–∏–º–∞–µ–º –≤—Å–µ NFT
            gameState.nfts.forEach(nft => nft.equipped = false);
            
            // –ù–∞–¥–µ–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π
            const nft = gameState.nfts.find(n => n.id === nftId);
            if (nft) {
                nft.equipped = true;
                gameState.nft_boost = nft.bonus;
            }
            
            updateUI();
            loadNFTInventory();
            saveGame();
            
            showNotification(`NFT "${nft.name}" —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω!`, 'success');
        }

        function loadNFTInventory() {
            const container = document.getElementById('nft-inventory');
            if (!container) return;
            
            if (gameState.nfts.length === 0) {
                container.innerHTML = '<p style="text-align:center;opacity:0.7;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç NFT</p>';
                return;
            }
            
            container.innerHTML = '';
            gameState.nfts.forEach(nft => {
                const card = document.createElement('div');
                card.className = 'nft-card';
                card.innerHTML = `
                    <div class="nft-rarity ${nft.rarity}">${nft.rarity}</div>
                    <h4>${nft.name}</h4>
                    <p>–ë–æ–Ω—É—Å: √ó${nft.bonx}</p>
                    <button class="btn ${nft.equipped ? 'btn-warning' : ''}" onclick="equipNft('${nft.id}')" ${nft.equipped ? 'disabled' : ''}>
                        ${nft.equipped ? '‚úÖ –≠–∫–∏–ø–∏—Ä–æ–≤–∞–Ω' : '‚ö° –≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å'}
                    </button>
                `;
                container.appendChild(card);
            });
        }

        // ====== PvP –°–ò–°–¢–ï–ú–ê ======
        let pvpBattle = null;
        let pvpInterval = null;

        function startPvPBattle(type) {
            const entryFee = type === 'bot' ? 100 : 500;
            
            if (gameState.balance < entryFee) {
                showNotification(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –ù—É–∂–Ω–æ ${entryFee} ‚Çø`, 'error');
                return;
            }
            
            gameState.balance -= entryFee;
            
            pvpBattle = {
                type: type,
                playerScore: 0,
                opponentScore: 0,
                opponent: type === 'bot' ? 'ü§ñ –ë–æ—Ç' : 'üë§ –ò–≥—Ä–æ–∫#' + Math.floor(Math.random() * 1000),
                timeLeft: 60,
                entryFee: entryFee
            };
            
            document.getElementById('pvp-menu').style.display = 'none';
            document.getElementById('battle-arena').style.display = 'block';
            document.getElementById('battle-title').textContent = type === 'bot' ? '–ë–æ–π —Å –ë–æ—Ç–æ–º' : 'PvP –ë–æ–π';
            document.getElementById('opponent-name').textContent = pvpBattle.opponent;
            
            battleTime = 60;
            document.getElementById('battle-timer').textContent = battleTime;
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            pvpInterval = setInterval(() => {
                battleTime--;
                document.getElementById('battle-timer').textContent = battleTime;
                
                // –ë–æ—Ç –∫–ª–∏–∫–∞–µ—Ç (–µ—Å–ª–∏ –±–æ–π —Å –±–æ—Ç–æ–º)
                if (type === 'bot' && Math.random() > 0.7) {
                    pvpBattle.opponentScore += Math.floor(Math.random() * 10) + 1;
                    document.getElementById('player2-score').textContent = pvpBattle.opponentScore;
                }
                
                if (battleTime <= 0) {
                    endPvPBattle();
                }
            }, 1000);
            
            updateUI();
        }

        function pvpClick() {
            if (!pvpBattle) return;
            
            pvpBattle.playerScore += Math.floor(gameState.per_click * gameState.nft_boost);
            document.getElementById('player1-score').textContent = pvpBattle.playerScore;
            
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function endPvPBattle() {
            clearInterval(pvpInterval);
            
            if (!pvpBattle) return;
            
            const playerWon = pvpBattle.playerScore > pvpBattle.opponentScore;
            const reward = pvpBattle.entryFee * 2;
            
            if (playerWon) {
                gameState.balance += reward;
                gameState.pvp_wins++;
                showNotification(`üéâ –ü–æ–±–µ–¥–∞! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${reward} ‚Çø`, 'success');
            } else {
                gameState.pvp_losses++;
                showNotification('üòî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑', 'error');
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–µ–Ω—é
            setTimeout(() => {
                document.getElementById('pvp-menu').style.display = 'block';
                document.getElementById('battle-arena').style.display = 'none';
                pvpBattle = null;
                
                updateUI();
                saveGame();
            }, 3000);
        }

        // ====== –ú–ò–ù–ò-–ò–ì–†–´ ======
        function startMinigame(type) {
            const container = document.getElementById('minigame-container');
            const gamesContainer = document.querySelector('.minigame-container');
            
            gamesContainer.style.display = 'none';
            container.style.display = 'block';
            container.innerHTML = '';
            
            switch(type) {
                case 'clicker':
                    startClickerGame(container);
                    break;
                case 'number':
                    startNumberGame(container);
                    break;
                case 'memory':
                    startMemoryGame(container);
                    break;
                case 'slots':
                    startSlotsGame(container);
                    break;
            }
            
            gameState.minigame_stats[type].played++;
        }

        function startClickerGame(container) {
            let clicks = 0;
            let timeLeft = 10;
            
            container.innerHTML = `
                <div class="header">
                    <h2>‚ö° –ö–ª–∏–∫-—á–µ–ª–ª–µ–Ω–¥–∂</h2>
                    <p>–ö–ª–∏–∫–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!</p>
                    <div id="clicker-timer" style="font-size: 2rem; color: #ff9800;">${timeLeft}</div>
                    <div id="clicker-count" style="font-size: 3rem; color: #00e676; margin: 20px 0;">0</div>
                    <button class="click-btn" id="clicker-btn">–ö–õ–ò–ö–ê–ô!</button>
                </div>
            `;
            
            const timerElement = document.getElementById('clicker-timer');
            const countElement = document.getElementById('clicker-count');
            const button = document.getElementById('clicker-btn');
            
            button.onclick = () => {
                clicks++;
                countElement.textContent = clicks;
                
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            };
            
            const timer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    button.disabled = true;
                    
                    const reward = Math.min(clicks * 10, 1000);
                    gameState.balance += reward;
                    
                    if (clicks > gameState.minigame_stats.clicker.best) {
                        gameState.minigame_stats.clicker.best = clicks;
                    }
                    
                    container.innerHTML += `
                        <div style="text-align:center; margin-top:20px;">
                            <h3>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h3>
                            <p>–ö–ª–∏–∫–æ–≤: ${clicks}</p>
                            <p>–í—ã–∏–≥—Ä—ã—à: ${reward} ‚Çø</p>
                            <button class="btn" onclick="showSection('minigames')">–ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º</button>
                        </div>
                    `;
                    
                    updateUI();
                    saveGame();
                }
            }, 1000);
        }

        function startNumberGame(container) {
            const secretNumber = Math.floor(Math.random() * 100) + 1;
            let attempts = 5;
            let guessed = false;
            
            container.innerHTML = `
                <div class="header">
                    <h2>üî¢ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ</h2>
                    <p>–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100. –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: <span id="attempts">${attempts}</span></p>
                    <input type="number" id="number-input" min="1" max="100" style="width:100px;padding:10px;font-size:1.5rem;text-align:center;margin:20px;background:rgba(255,255,255,0.1);color:white;border:2px solid #4fc3f7;border-radius:5px;">
                    <button class="btn" id="guess-btn">–£–≥–∞–¥–∞—Ç—å</button>
                    <div id="number-hint" style="margin-top:20px;"></div>
                </div>
            `;
            
            const input = document.getElementById('number-input');
            const hint = document.getElementById('number-hint');
            const attemptsElement = document.getElementById('attempts');
            
            document.getElementById('guess-btn').onclick = () => {
                const guess = parseInt(input.value);
                
                if (isNaN(guess) || guess < 1 || guess > 100) {
                    hint.textContent = '–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100!';
                    hint.style.color = '#ff4444';
                    return;
                }
                
                attempts--;
                attemptsElement.textContent = attempts;
                
                if (guess === secretNumber) {
                    guessed = true;
                    const reward = attempts * 400; // –ß–µ–º –±—ã—Å—Ç—Ä–µ–µ —É–≥–∞–¥–∞–ª, —Ç–µ–º –±–æ–ª—å—à–µ
                    gameState.balance += reward;
                    gameState.minigame_stats.number.wins++;
                    
                    container.innerHTML += `
                        <div style="text-align:center; margin-top:20px;">
                            <h3>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h3>
                            <p>–í—ã —É–≥–∞–¥–∞–ª–∏ —á–∏—Å–ª–æ ${secretNumber}!</p>
                            <p>–í—ã–∏–≥—Ä—ã—à: ${reward} ‚Çø</p>
                            <button class="btn" onclick="showSection('minigames')">–ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º</button>
                        </div>
                    `;
                } else {
                    hint.textContent = `–ß–∏—Å–ª–æ ${guess} —Å–ª–∏—à–∫–æ–º ${guess < secretNumber ? '–º–∞–ª–µ–Ω—å–∫–æ–µ' : '–±–æ–ª—å—à–æ–µ'}`;
                    hint.style.color = '#ff9800';
                    
                    if (attempts <= 0) {
                        container.innerHTML += `
                            <div style="text-align:center; margin-top:20px;">
                                <h3>üòî –ü–æ—Ä–∞–∂–µ–Ω–∏–µ!</h3>
                                <p>–ó–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –±—ã–ª–æ: ${secretNumber}</p>
                                <button class="btn" onclick="showSection('minigames')">–ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º</button>
                            </div>
                        `;
                    }
                }
                
                input.value = '';
                input.focus();
                
                if (guessed || attempts <= 0) {
                    updateUI();
                    saveGame();
                }
            };
        }

        function startSlotsGame(container) {
            const symbols = ['üçí', 'üçã', 'üçä', 'üçá', '‚≠ê', '7Ô∏è‚É£'];
            let balance = 100;
            
            container.innerHTML = `
                <div class="header">
                    <h2>üé∞ –°–ª–æ—Ç—ã</h2>
                    <p>–ë–∞–ª–∞–Ω—Å: <span id="slots-balance">${balance}</span> ‚Çø</p>
                    <div id="slots" style="font-size: 4rem; letter-spacing: 20px; margin: 30px 0;">‚ùì ‚ùì ‚ùì</div>
                    <button class="btn" id="spin-btn">–ö—Ä—É—Ç–∏—Ç—å (10 ‚Çø)</button>
                    <div id="slots-result" style="margin-top:20px;font-size:1.2rem;"></div>
                </div>
            `;
            
            const spinBtn = document.getElementById('spin-btn');
            const resultElement = document.getElementById('slots-result');
            const balanceElement = document.getElementById('slots-balance');
            
            spinBtn.onclick = () => {
                if (balance < 10) {
                    resultElement.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!';
                    resultElement.style.color = '#ff4444';
                    return;
                }
                
                balance -= 10;
                balanceElement.textContent = balance;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
                let spins = 0;
                const maxSpins = 10;
                const spinInterval = setInterval(() => {
                    const slot1 = symbols[Math.floor(Math.random() * symbols.length)];
                    const slot2 = symbols[Math.floor(Math.random() * symbols.length)];
                    const slot3 = symbols[Math.floor(Math.random() * symbols.length)];
                    
                    document.getElementById('slots').textContent = `${slot1} ${slot2} ${slot3}`;
                    
                    spins++;
                    if (spins >= maxSpins) {
                        clearInterval(spinInterval);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∏–≥—Ä—ã—à–∞
                        if (slot1 === slot2 && slot2 === slot3) {
                            const winAmount = slot1 === '7Ô∏è‚É£' ? 500 : 200;
                            balance += winAmount;
                            balanceElement.textContent = balance;
                            resultElement.textContent = `üéâ –î–ñ–ï–ö–ü–û–¢! +${winAmount} ‚Çø`;
                            resultElement.style.color = '#00e676';
                            gameState.minigame_stats.slots.wins++;
                        } else if (slot1 === slot2 || slot2 === slot3 || slot1 === slot3) {
                            balance += 50;
                            balanceElement.textContent = balance;
                            resultElement.textContent = `üëç –ü–∞—Ä–æ—á–∫–∞! +50 ‚Çø`;
                            resultElement.style.color = '#4fc3f7';
                        } else {
                            resultElement.textContent = 'üòî –ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!';
                            resultElement.style.color = '#ff9800';
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                        if (balance <= 0 || Math.random() > 0.7) {
                            setTimeout(() => {
                                const totalWin = balance - 100;
                                if (totalWin > 0) {
                                    gameState.balance += totalWin;
                                    showNotification(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${totalWin} ‚Çø –≤ —Å–ª–æ—Ç–∞—Ö!`, 'success');
                                }
                                
                                container.innerHTML += `
                                    <div style="text-align:center; margin-top:20px;">
                                        <p>–ò—Ç–æ–≥: ${totalWin >= 0 ? '+' : ''}${totalWin} ‚Çø</p>
                                        <button class="btn" onclick="showSection('minigames')">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
                                    </div>
                                `;
                                
                                updateUI();
                                saveGame();
                            }, 2000);
                        }
                    }
                }, 100);
            };
        }

        function startMemoryGame(container) {
            // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –Ω–∞ –ø–∞–º—è—Ç—å
            const sequence = [];
            for (let i = 0; i < 5; i++) {
                sequence.push(Math.floor(Math.random() * 9) + 1);
            }
            
            let currentStep = 0;
            let showingSequence = true;
            
            container.innerHTML = `
                <div class="header">
                    <h2>üß† –ò–≥—Ä–∞ –Ω–∞ –ø–∞–º—è—Ç—å</h2>
                    <p>–ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–∏—Å–µ–ª!</p>
                    <div id="memory-display" style="font-size: 4rem; margin: 30px 0;"></div>
                    <div id="memory-input" style="display:none;">
                        <input type="number" id="memory-guess" min="1" max="9" style="width:100px;padding:10px;font-size:2rem;text-align:center;">
                        <button class="btn" id="memory-submit">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                    </div>
                    <div id="memory-result"></div>
                </div>
            `;
            
            const display = document.getElementById('memory-display');
            const inputContainer = document.getElementById('memory-input');
            const resultElement = document.getElementById('memory-result');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            function showSequence() {
                if (currentStep < sequence.length) {
                    display.textContent = sequence[currentStep];
                    currentStep++;
                    setTimeout(() => {
                        display.textContent = '';
                        setTimeout(showSequence, 500);
                    }, 1000);
                } else {
                    showingSequence = false;
                    currentStep = 0;
                    display.textContent = '?';
                    inputContainer.style.display = 'block';
                    document.getElementById('memory-guess').focus();
                }
            }
            
            showSequence();
            
            document.getElementById('memory-submit').onclick = () => {
                const guess = parseInt(document.getElementById('memory-guess').value);
                
                if (guess === sequence[currentStep]) {
                    currentStep++;
                    resultElement.textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω–æ! (${currentStep}/${sequence.length})`;
                    resultElement.style.color = '#00e676';
                    
                    if (currentStep >= sequence.length) {
                        const reward = 1000;
                        gameState.balance += reward;
                        gameState.minigame_stats.memory.best = Math.max(gameState.minigame_stats.memory.best, sequence.length);
                        
                        container.innerHTML += `
                            <div style="text-align:center; margin-top:20px;">
                                <h3>üéâ –ü–æ–±–µ–¥–∞!</h3>
                                <p>–í—ã –∑–∞–ø–æ–º–Ω–∏–ª–∏ –≤—Å—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!</p>
                                <p>–í—ã–∏–≥—Ä—ã—à: ${reward} ‚Çø</p>
                                <button class="btn" onclick="showSection('minigames')">–ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º</button>
                            </div>
                        `;
                        
                        updateUI();
                        saveGame();
                        return;
                    }
                } else {
                    const reward = currentStep * 200;
                    gameState.balance += reward;
                    
                    container.innerHTML += `
                        <div style="text-align:center; margin-top:20px;">
                            <h3>üòî –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</h3>
                            <p>–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${sequence.join(', ')}</p>
                            <p>–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${currentStep} –∏–∑ ${sequence.length}</p>
                            <p>–í—ã–∏–≥—Ä—ã—à: ${reward} ‚Çø</p>
                            <button class="btn" onclick="showSection('minigames')">–ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–∞–º</button>
                        </div>
                    `;
                    
                    updateUI();
                    saveGame();
                    return;
                }
                
                document.getElementById('memory-guess').value = '';
                document.getElementById('memory-guess').focus();
            };
        }

        // ====== –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê ======
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function copyReferralCode() {
            const code = document.getElementById('referral-code').textContent;
            navigator.clipboard.writeText(code)
                .then(() => showNotification('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success'))
                .catch(() => {
                    const textarea = document.createElement('textarea');
                    textarea.value = code;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showNotification('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
                });
        }

        function updateReferralUI() {
            document.getElementById('referral-code').textContent = gameState.referral_code;
            document.getElementById('referrals-count').textContent = gameState.referrals.length;
            document.getElementById('referral-earnings').textContent = formatNumber(gameState.referral_earnings) + ' ‚Çø';
        }

        // ====== –ü–†–û–ú–û–ö–û–î–´ ======
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function activatePromocode() {
            const input = document.getElementById('promocode-input');
            const code = input.value.trim().toUpperCase();
            
            if (!code) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥!', 'error');
                return;
            }
            
            if (gameState.used_promocodes.includes(code)) {
                showNotification('–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!', 'error');
                return;
            }
            
            if (!promocodes[code]) {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥!', 'error');
                return;
            }
            
            const reward = promocodes[code].reward;
            gameState.balance += reward;
            gameState.used_promocodes.push(code);
            
            input.value = '';
            closeModal('promocode-modal');
            
            showNotification(`üéâ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +${reward} ‚Çø`, 'success');
            updateUI();
            saveGame();
        }

        // ====== –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–° ======
        function checkDailyBonus() {
            const today = new Date().toDateString();
            const lastBonus = localStorage.getItem('cryptoKombat_last_bonus');
            
            if (lastBonus !== today) {
                const bonus = 1000 + (gameState.daily_streak || 0) * 100;
                gameState.balance += bonus;
                gameState.daily_streak = (gameState.daily_streak || 0) + 1;
                localStorage.setItem('cryptoKombat_last_bonus', today);
                
                setTimeout(() => {
                    showNotification(`üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å! +${bonus} ‚Çø (—Å–µ—Ä–∏—è: ${gameState.daily_streak} –¥–Ω–µ–π)`, 'success');
                    updateUI();
                    saveGame();
                }, 1000);
            }
        }

        // ====== –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î ======
        function startPassiveIncome() {
            setInterval(() => {
                if (gameState.passive_per_sec > 0) {
                    gameState.balance += gameState.passive_per_sec / 10;
                    updateUI();
                }
            }, 100);
        }

        // ====== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ======
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.classList.add('error');
            } else if (type === 'warning') {
                notification.classList.add('warning');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ====== –ù–ê–í–ò–ì–ê–¶–ò–Ø ======
        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
            document.getElementById(sectionId + '-section').classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-tabs button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–∏–Ω–∏-–∏–≥—Ä—É –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ –¥—Ä—É–≥—É—é —Å–µ–∫—Ü–∏—é
            if (sectionId !== 'minigames') {
                const gamesContainer = document.querySelector('.minigame-container');
                const gameContainer = document.getElementById('minigame-container');
                if (gamesContainer && gameContainer) {
                    gamesContainer.style.display = 'grid';
                    gameContainer.style.display = 'none';
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å–µ–∫—Ü–∏–π
            if (sectionId === 'upgrades') renderUpgrades();
            if (sectionId === 'nft') loadNFTInventory();
            if (sectionId === 'pvp') {
                document.getElementById('pvp-menu').style.display = 'block';
                document.getElementById('battle-arena').style.display = 'none';
            }
        }

        // ====== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ======
        window.buyUpgrade = buyUpgrade;
        window.buyNftBox = buyNftBox;
        window.equipNft = equipNft;
        window.showSection = showSection;
        window.resetClickLimit = resetClickLimit;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.activatePromocode = activatePromocode;
        window.copyReferralCode = copyReferralCode;
        window.startPvPBattle = startPvPBattle;
        window.pvpClick = pvpClick;
        window.startMinigame = startMinigame;

        // ====== –ó–ê–ü–£–°–ö –ò–ì–†–´ ======
        document.addEventListener('DOMContentLoaded', () => {
            loadGame();
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveGame, 30000);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –∏–≥—Ä–∞ –±—ã–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
                console.log('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥:', refCode);
            }
        });
    </script>
</body>
</html>